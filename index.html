<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFT Ultimate Database - Mahmoud Ayman</title>
    <style>
        :root { --bg: #050505; --neon: #00ff9d; --surface: #121212; --text: #e0e0e0; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        header { text-align: center; padding: 30px; border-bottom: 2px solid #222; margin-bottom: 20px; }
        header h1 { color: var(--neon); letter-spacing: 2px; }
        
        /* منطقة رفع الملفات */
        .upload-section { background: var(--surface); padding: 20px; border-radius: 12px; border: 1px dashed var(--neon); text-align: center; margin-bottom: 20px; }
        .upload-btn { background: #1a1a1a; color: var(--neon); padding: 10px 20px; border: 1px solid var(--neon); cursor: pointer; border-radius: 5px; }

        .search-box { width: 100%; padding: 15px; background: #000; border: 1px solid #333; color: var(--neon); border-radius: 10px; font-size: 1.2rem; margin-bottom: 20px; }
        
        .stats { font-size: 0.9rem; color: #888; margin-bottom: 10px; }
        .results { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .card { background: var(--surface); border: 1px solid #222; padding: 15px; border-radius: 10px; transition: 0.3s; }
        .card:hover { border-color: var(--neon); transform: translateY(-5px); }
        .card h3 { margin: 0 0 10px 0; color: #fff; }
        .tag { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.8rem; margin: 2px; background: #222; }
        .tag-cpu { color: #00bcd4; border: 1px solid #00bcd4; }
        .tag-method { color: var(--neon); border: 1px solid var(--neon); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>⚡ TFT GLOBAL DATABASE</h1>
        <p>بواسطة المبرمج: محمود أيمن</p>
    </header>

    <div class="upload-section">
        <p>ارفع ملفات الـ JSON (Samsung, Xiaomi, etc.) لدمجها فوراً</p>
        <input type="file" id="fileInput" multiple accept=".json" style="display:none">
        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">اختر الملفات من جهازك</button>
    </div>

    <input type="text" id="searchBox" class="search-box" placeholder="ابحث باسم الجهاز، الموديل، أو المعالج (مثلاً: MT6765)..." oninput="search()">
    
    <div class="stats" id="stats">قاعدة البيانات فارغة.. ارفع الملفات للبدء.</div>
    
    <div class="results" id="results"></div>
</div>

<script>
    let masterDB = [];

    // دالة قراءة ودمج الملفات
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const files = e.target.files;
        for (let file of files) {
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const data = JSON.parse(event.target.result);
                    // تنظيف الداتا ودمجها
                    const cleanData = data.filter(item => item.Devices && !item.Devices.includes("Devices :"));
                    masterDB = masterDB.concat(cleanData);
                    updateStats();
                } catch (err) {
                    console.error("خطأ في ملف: " + file.name);
                }
            };
            reader.readAsText(file);
        }
    });

    function updateStats() {
        document.getElementById('stats').innerText = `تم تحميل ${masterDB.length} جهاز بنجاح. يمكنك البحث الآن!`;
    }

    function search() {
        const query = document.getElementById('searchBox').value.toLowerCase();
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';

        if (query.length < 2) return;

        // نظام البحث "الوحش"
        const filtered = masterDB.filter(item => 
            (item.Devices && item.Devices.toLowerCase().includes(query)) ||
            (item.Models && item.Models.toLowerCase().includes(query)) ||
            (item.Platform && item.Platform.toLowerCase().includes(query))
        ).slice(0, 50); // عرض أول 50 نتيجة للسرعة

        filtered.forEach(item => {
            // تجميع طرق التوصيل من الحقول المختلفة (Brom, Edl, spd, Conn)
            let methods = [];
            if(item.Brom && item.Brom !== "Brom") methods.push(item.Brom); // أحيانا بيكون مكتوب Brom كقيمة افتراضية
            if(item.Edl && item.Edl !== "Edl") methods.push(item.Edl);
            if(item.spd && item.spd !== "spd") methods.push("SPD");
            if(item.Conn && item.Conn.includes("auth")) methods.push("Auth BROM");
            if(item.Conn && item.Conn.includes("adb")) methods.push("ADB/MTP");
            if(item.Beta && item.Beta.includes("Sideload")) methods.push("Sideload");
            if(item.Storage && item.Storage === "TP") methods.push("Test Point");

            // لو مفيش طرق محددة، نعتمد على القيم الافتراضية بناء على المعالج
            if(methods.length === 0) {
                 if(item.Brom === "Brom") methods.push("BROM Mode");
                 if(item.Edl === "Edl") methods.push("EDL Mode");
            }

            const methodBadges = methods.map(m => `<span class="tag tag-method">${m}</span>`).join(' ');

            resultsDiv.innerHTML += `
                <div class="card">
                    <h3>${item.Devices}</h3>
                    <p style="font-size:0.9rem; color:#aaa">الموديل: ${item.Models || 'N/A'}</p>
                    <div style="margin-top:10px;">
                        <span class="tag tag-cpu">${item.Platform || 'Unknown CPU'}</span>
                        ${methodBadges}
                        ${item.Storage ? `<span class="tag" style="color:#ff4081; border:1px solid #ff4081">${item.Storage}</span>` : ''}
                    </div>
                </div>
            `;
        });
    }
</script>

</body>
</html>
